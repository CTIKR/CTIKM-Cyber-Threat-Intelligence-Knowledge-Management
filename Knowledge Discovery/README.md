# Knowledge Discovery



## Workflow
**CTI Article Summary:**
1. Collect test set articles from Knowledge Representation phase.
2. Based on the **Knowledge Extraction** models, obtain the tactical label and behavioral label information of the articles in the test set. Create the **Article Clustering Results Test Set.xlsx** file by statistical analysis.
3. Use the **Topic Classification.ipynb** file to unsupervised cluster the articles in the test set into different groups.
4. Calculate the silhouette coefficient, manually inspect articles in different groups and identity whether the article's topic follow the table **Topics And Accuracy Of Article Clusters** in Knowledge Representation phase, and summary the result as table **Silhouette Coefficients And Topic Accuracy Of Test Set Article Clusters**.

**Entity-Relationship Summary:**
1. Download pkl file [**cluster_extracts_high_value.pkl**](https://huggingface.co/CTIKR/CTIKM_Cyber_Threat_Intelligence_Knowledge_Management/blob/main/cluster_extracts_high_value.pkl) to local folder. Use **Seacrch-On-Graph.ipynb** to search graph to reveal entities with most in-out edges relationship related between entities.
2. Use **Knowledge Discovery.ipynb** to visualize sub-graph of specific entities, and communities.


## Approach
For topic classification, open the **Topic Classification.ipynb**, and load the **Article Clustering Results Test Set.xlsx** which already has different feature values. Run the **Import the data** cell to load the **Article Clustering Results Test Set.xlsx** to generate a dataframe **df_test** contains all values. Then run the **Generate the feature vectors and cluster the blogs in the test set.** cell to summary one feature vector based on different values and find the most similar cluster in the training set based on the feature vector and **HDBSCANCluster**. The returned result is  list **testLabel** that contains cluster of article in the test set.

The **Topic Classification.ipynb** also contains the code for silhouette coefficient calculation and 2D visualization of the test set. Run the **Calculation of silhouette coefficient for the test set** cell to calculate the silhouette coefficient and the **Generate the 2D visualization of the test set** cell to visualize the clustering result based on reduced dimensional feature vectors. The silhouette coefficient and rate of same topic as training set are shown in the following table:

<p align="center">
  <b>Silhouette Coefficients And Topic Accuracy Of Test Set Article Clusters</b>
  
| Group | Silhouette Coefficients | Rate of Same Topic |
|-------|-------------------------|--------------------|
| 0     | 0.216                   | 80.00%             |
| 1     | 0.225                   | 75.00%             |
| 2     | 0.089                   | 80.00%             |
| 3     | 0.254                   | 84.20%             |
| 4     | 0.185                   | 85.00%             |
| 5     | 0.357                   | 90.00%             |
| 6     | 0.196                   | 55.00%             |
| 7     | 0.330                   | 95.00%             |
| 8     | 0.200                   | 71.40%             |
| 9     | 0.366                   | 80.00%             |
| 10    | 0.130                   | 25.00%             |
| 11    | 0.270                   | 75.00%             |
| 12    | 0.297                   | 65.00%             |
| 13    | 0.191                   | 75.00%             |
| 14    | 0.113                   | 54.50%             |
| 15    | 0.348                   | 25.00%             |
| 16    | 0.272                   | 33.30%             |
| 17    | 0.222                   | 62.50%             |
| 18    | 0.096                   | 43.75%             |
  
</p>

For community generation and entity behavior discovery, open the **Knowledge Discovery.ipynb**. First, load the knowledge graph you generated from the knowledge representation module. Run the **Entity Behavior Discovery** cell with your query to discover the behavior of the entity. Run the **Community Detection** cell to generate communities.

## Topic Classification result
Title: Life Isn't So Beautiful Naked Security

Group: 4 (Attacker enter the target system without being noticed)

Topic Classification result: True

Model result: 

| Sentences                                                                                                                                                                                                |   Attack tactics|Actual behavior|
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------:|:------------------------:|
| by Sophos                                                                                                                                                                                                |            None            |           FALSE          |
| Labs                                                                                                                                                                                                     |            None            |           FALSE          |
| Sophos                                                                                                                                                                                                   |            None            |           FALSE          |
| Labs encountered a newly spammed out Trojan today thats making its way to email servers around the world .                                                                                               |       Initial Access       |           FALSE          |
| The email has the following characteristics :                                                                                                                                                            |       Initial Access       |           FALSE          |
| The subject lines can be any of the following :                                                                                                                                                          |            None            |           FALSE          |
| Life is beautiful Life will be better Good summer help you                                                                                                                                               |            None            |           FALSE          |
| The message contents are typically of the following :                                                                                                                                                    |            None            |           FALSE          |
| Good morning evening , man !                                                                                                                                                                             |            None            |           FALSE          |
| Realy cool screensaver in your attachment !                                                                                                                                                              |       Initial Access       |           FALSE          |
| Wanna more ?                                                                                                                                                                                             |            None            |           FALSE          |
| Welcome to our siteURL                                                                                                                                                                                   |            None            |           FALSE          |
| Good Bye. or Hello , old chap !                                                                                                                                                                          |            None            |           FALSE          |
| Cool screensaver in your attachment !                                                                                                                                                                    |            None            |           FALSE          |
| Wanna more ?                                                                                                                                                                                             |            None            |           FALSE          |
| Welcome to our site URL                                                                                                                                                                                  |            None            |           FALSE          |
| Thanks .                                                                                                                                                                                                 |            None            |           FALSE          |
| A sample screenshot of the spammed out Trojan looks like this :                                                                                                                                          |       Initial Access       |           FALSE          |
| The file attachment uses the filename bsaver.zip .                                                                                                                                                       |       Initial Access       |           FALSE          |
| Naturally , opening the file attachment and running the archived file within , bsaver .                                                                                                                  |       Initial Access       |           FALSE          |
| exe would not give you any screensaver .                                                                                                                                                                 |            None            |           FALSE          |
| In fact , running the archived file will result in another 2 pieces of malware being dropped .                                                                                                           |          Execution         |           TRUE           |
| The main file bsaver .                                                                                                                                                                                   |            None            |           FALSE          |
| exe ( detected as Troj / Agent FZB ) drops 2 kernel driver rootkits both of which are used to  stealth the Troj / Agent FZB Trojan ( detected as Troj / NTRoot KBY and Troj / Agent FVT respectively ) . | Execution, Defense Evasion |           TRUE           |

Title: GrayKey iPhone unlocker poses serious security concerns Malwarebytes Labs Malwarebytes Labs" and was incorrectly categorized

Group: 10 (Malicious code downloads additional malicious programs and command from server and steals local data without uploading to the server.)

Topic Classification result: False

Model result: 

| Sentences                                                                                                                                                                                                                                                                                                       | Attack tactics                  | Actual behavior |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|-----------------|
| Ever since the case of the San Bernadino shooter pitted Apple against the FBI over the unlocking of an i Phone , opinions have been split on providing backdoor access to the i Phone for law enforcement .                                                                                                     | None                            | FALSE           |
| Some felt that Apple was aiding and abetting a felony by refusing to create a special version of iOS with a backdoor for accessing the phones data .                                                                                                                                                            | None                            | FALSE           |
| Others believed that its impossible to give backdoor access to law enforcement without threatening the security of lawabiding citizens .                                                                                                                                                                        | None                            | FALSE           |
| In an interesting twist , the battle ended with the FBI dropping the case after finding a third party who could help .                                                                                                                                                                                          | None                            | FALSE           |
| At the time , it was theorized that the third party was Cellebrite .                                                                                                                                                                                                                                            | None                            | FALSE           |
| Since then it has become known that Cellebrite an Israeli companydoes provide i Phone unlocking services to law enforcement agencies .                                                                                                                                                                          | None                            | FALSE           |
| Cellebrite , through means currently unknown , provides these services at 5,000 per device , and for the most part this involves sending the phones to a Cellebrite facility .                                                                                                                                  | None                            | FALSE           |
| ( Recently , Cellebrite has begun providing inhouse unlocking services , but those services are protected heavily by nondisclosure agreements , so little is known about them . )                                                                                                                               | None                            | FALSE           |
| It is theorized , and highly likely , that Cellebrite knows of one or more iOS vulnerabilities that allow them to access the devices .                                                                                                                                                                          | None                            | FALSE           |
| In late 2017 , word of a new i Phone unlocker device started to circulate : a device called GrayKey , made by a company named Grayshift .                                                                                                                                                                       | None                            | FALSE           |
| Based in Atlanta , Georgia , Grayshift was founded in 2016 , and is a privatelyheld company with fewer than 50 employees .                                                                                                                                                                                      | None                            | FALSE           |
| Little was known publicly about this deviceor even whether it was a device or a serviceuntil recently , as the GrayKey website is protected by a portal that screens for law enforcement affiliation .                                                                                                          | None                            | FALSE           |
| According to Forbes , the GrayKey i Phone unlocker device is marketed for inhouse use at law enforcement offices or labs .                                                                                                                                                                                      | None                            | FALSE           |
| This is drastically different from Cellebrites overall business model , in that it puts complete control of the process in the hands of law enforcement .                                                                                                                                                       | None                            | FALSE           |
| Thanks to an anonymous source , we now know what this mysterious device looks like , and how it works .                                                                                                                                                                                                         | None                            | FALSE           |
| And while the technology is a good thing for law enforcement , it presents some significant security risks .                                                                                                                                                                                                    | None                            | FALSE           |
| How it works GrayKey is a gray box , four inches wide by four inches deep by two inches tall , with two lightning cables sticking out of the front .                                                                                                                                                            | None                            | FALSE           |
| Two i Phones can be connected at one time , and are connected for about two minutes .                                                                                                                                                                                                                           | None                            | FALSE           |
| After that , they are disconnected from the device , but are not yet cracked .                                                                                                                                                                                                                                  | None                            | FALSE           |
| Some time later , the phones will display a black screen with the passcode , among other information .                                                                                                                                                                                                          | DataLeak                        | FALSE           |
| The exact length of time varies , taking about two hours in the observations of our source .                                                                                                                                                                                                                    | None                            | FALSE           |
| It can take up to three days or longer for sixdigit passcodes , according to Grayshift documents , and the time needed for longer passphrases is not mentioned .                                                                                                                                                | None                            | FALSE           |
| Even disabled phones can be unlocked , according to Grayshift .                                                                                                                                                                                                                                                 | None                            | FALSE           |
| After the device is unlocked , the full contents of the filesystem are downloaded to the GrayKey device .                                                                                                                                                                                                       | Command and Control, DataLeak   | TRUE            |
| From there , they can be accessed through a webbased interface on a connected computer , and downloaded for analysis .                                                                                                                                                                                          | Command and Control             | TRUE            |
| The full , unencrypted contents of the keychain are also available for download .                                                                                                                                                                                                                               | DataLeak                        | FALSE           |
| As can be seen in the screenshot above , the GrayKey works on the latest hardware , and at least on iOS up to 11.2.5 ( which was likely the most current system at the time this image was captured ) .                                                                                                         | None                            | FALSE           |
| The GrayKey device itself comes in two flavors .                                                                                                                                                                                                                                                                | None                            | FALSE           |
| The first , a 15,000 option , requires Internet connectivity to work .                                                                                                                                                                                                                                          | None                            | FALSE           |
| It is strictly geofenced , meaning that once it is set up , it cannot be used on any other network .                                                                                                                                                                                                            | None                            | FALSE           |
| However , there is also a 30,000 option .                                                                                                                                                                                                                                                                       | None                            | FALSE           |
| At this price , the device requires no Internet connection whatsoever and has no limit to the number of unlocks .                                                                                                                                                                                               | None                            | FALSE           |
| It will work for as long as it works ; presumably , until Apple fixes whatever vulnerabilities the device relies on , at which time updated phones would no longer be unlockable .                                                                                                                              | None                            | FALSE           |
| The offline model does require tokenbased twofactor authentication as a replacement for geofencing for ensuring security .                                                                                                                                                                                      | None                            | FALSE           |
| However , as people often write passwords on stickies and put them on their monitors , its probably too much to hope that the token will be kept in a separate location when the GrayKey is not being used .                                                                                                    | None                            | FALSE           |
| Most likely , it will be stored nearby for easy access .                                                                                                                                                                                                                                                        | None                            | FALSE           |
| Implications                                                                                                                                                                                                                                                                                                    | None                            | FALSE           |
| For law enforcement , this is undoubtedly a boon .                                                                                                                                                                                                                                                              | None                            | FALSE           |
| However , historically , similar stories involving cracking the i Phone havent turned out so well .                                                                                                                                                                                                             | None                            | FALSE           |
| Consider , for example , the case of the IPBox , a similar device that was once used to access the contents of i Phones running older versions of iOS .                                                                                                                                                         | DataLeak                        | FALSE           |
| The utility of the original IPBox ended in i OS 8.2 , which gave rise to the IPBox 2 .                                                                                                                                                                                                                          | None                            | FALSE           |
| Unfortunately , the IPBox 2 became widely available and was almost exclusively used illegitimately , rather than in law enforcement .                                                                                                                                                                           | None                            | FALSE           |
| Today , various IPBoxes can still be found being sold through a variety of websites , even including Amazon .                                                                                                                                                                                                   | None                            | FALSE           |
| Anyone who wants such a device can get one .                                                                                                                                                                                                                                                                    | None                            | FALSE           |
| What happens if the GrayKey becomes commonplace in law enforcement ?                                                                                                                                                                                                                                            | None                            | FALSE           |
| The cheaper model isnt much of a danger if stolenunless its stolen prior to setupbut at 4 x 4 x 2 , the unlimited model could be pocketed fairly easily , along with its token , if stored nearby .                                                                                                             | None                            | FALSE           |
| Once offsite , it would continue to work .                                                                                                                                                                                                                                                                      | None                            | FALSE           |
| Such a device could fetch a high price on the black market , giving thieves the ability to unlock and resell stolen phones , as well as access to the highvalue data on those phones .                                                                                                                          | DataLeak                        | FALSE           |
| Worse , consider the implications of what is done to the phone itself .                                                                                                                                                                                                                                         | None                            | FALSE           |
| It is currently not known how the process works , but its obvious there is some kind of jailbreak involved .                                                                                                                                                                                                    | None                            | FALSE           |
| ( A jailbreak involves using a vulnerability to unlock a phone , giving access to the system that is not normally allowed . )                                                                                                                                                                                   | Execution, Privilege Escalation | FALSE           |
| What happens to the device once it is released back to its owner ?                                                                                                                                                                                                                                              | None                            | FALSE           |
| Is it still jailbroken in a nonobvious way ?                                                                                                                                                                                                                                                                    | None                            | FALSE           |
| Is it open to remote access that would not normally be possible ?                                                                                                                                                                                                                                               | None                            | FALSE           |
| Will it be damaged to the point that it really cant be used as intended anymore , and will need to be replaced ?                                                                                                                                                                                                | None                            | FALSE           |
| Its unknown , but any of these are possibilities .                                                                                                                                                                                                                                                              | None                            | FALSE           |
| We also dont know what kind of security is present on the networked GrayKey device .                                                                                                                                                                                                                            | None                            | FALSE           |
| Could it be remotely accessed ?                                                                                                                                                                                                                                                                                 | None                            | FALSE           |
| Could data be intercepted in transit ?                                                                                                                                                                                                                                                                          | None                            | FALSE           |
| Is the phone data stored on the device strongly encrypted , weakly encrypted , or is it not even encrypted at all ?                                                                                                                                                                                             | None                            | FALSE           |
| We dont know .                                                                                                                                                                                                                                                                                                  | None                            | FALSE           |
| Most people probably wont get too excited about a criminals phone or data .                                                                                                                                                                                                                                     | None                            | FALSE           |
| However , lets keep in mind one of the fundamental principles of the US judicial system : suspects are innocent until proven guilty .                                                                                                                                                                           | None                            | FALSE           |
| Should suspects be susceptible to these kinds of searches by law enforcement ?                                                                                                                                                                                                                                  | None                            | FALSE           |
| Further , not all phones analyzed by law enforcement belong to suspects .                                                                                                                                                                                                                                       | None                            | FALSE           |
| In one digital forensics lab in 2014 , around onethird of the devices analyzed were given to the authorities with explicit consent , by alleged victims or witnesses , to assist in the investigation .                                                                                                         | DataLeak                        | FALSE           |
| In such cases , a passcode would likely be given , but its possible it didnt get passed on to the forensic technician .                                                                                                                                                                                         | DataLeak                        | FALSE           |
| Its also possible the technician may prefer to use the GrayKey to analyze the device regardless of availability of the passcode , due to the copious amounts of data it can generate from the device .                                                                                                          | DataLeak                        | FALSE           |
| This means that many innocent peoples phones will end up being analyzed using a GrayKey device .                                                                                                                                                                                                                | None                            | FALSE           |
| What happens if their phones are given back in a vulnerable state , or their data is handled insecurely ?                                                                                                                                                                                                       | None                            | FALSE           |
| That is not only a threat to the individual , but a liability for the police .                                                                                                                                                                                                                                  | None                            | FALSE           |
| Who should we trust ?                                                                                                                                                                                                                                                                                           | None                            | FALSE           |
| For most people in the US , law enforcement agents are people to be trusted .                                                                                                                                                                                                                                   | None                            | FALSE           |
| Obviously , this cant be true in all cases , people being people , but lets start from that assumption .                                                                                                                                                                                                        | None                            | FALSE           |
| Unfortunately , even if the agents themselves are completely trustworthy , sources in law enforcement have said that the computer systems used by law enforcement in the US are often quite poorly secured .                                                                                                    | None                            | FALSE           |
| Is it a good idea to trust sensitive data , some of which will come from the phones of innocent US citizens , to insecure systems ?                                                                                                                                                                             | None                            | FALSE           |
| Little is known about Grayshift or its sales model at this point .                                                                                                                                                                                                                                              | None                            | FALSE           |
| We dont know whether sales are limited to US law enforcement , or if it is also selling in other parts of the world .                                                                                                                                                                                           | None                            | FALSE           |
| Regardless of that , its highly likely that these devices will ultimately end up in the hands of agents of an oppressive regime , whether directly from Grayshift or indirectly through the black market .                                                                                                      | None                            | FALSE           |
| Its also entirely possible , based on the history of the IPBox , that Grayshift devices will end up being available to anyone who wants them and can find a way to purchase them , perhaps by being reverseengineered and reproduced by an enterprising hacker , then sold for a couple hundred bucks on eBay . | None                            | FALSE           |
| Conclusion                                                                                                                                                                                                                                                                                                      | None                            | FALSE           |
| An i Phone typically contains all manner of sensitive information : account credentials , names and phone numbers , email messages , text messages , banking account information , even credit card numbers or social security numbers .                                                                        | DataLeak                        | FALSE           |
| All of this information , even the most seemingly innocuous , has value on the black market , and can be used to steal your identity , access your online accounts , and steal your money .                                                                                                                     | DataLeak                        | FALSE           |
| The existence of the GrayKey isnt hugely surprising , nor is it a sign that the sky is falling .                                                                                                                                                                                                                | None                            | FALSE           |
| However , it does mean that an i Phones security cannot be ensured if it falls into a third partys hands .                                                                                                                                                                                                      | None                            | FALSE           |

## Community Detection result
We found 35 communities from the generated knowledge graph. We list the results in the folder **communities**.
